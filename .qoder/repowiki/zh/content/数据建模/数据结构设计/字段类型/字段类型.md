# 字段类型

<cite>
**本文档中引用的文件**  
- [string-field.ts](file://packages/core/database/src/fields/string-field.ts)
- [number-field.ts](file://packages/core/database/src/fields/number-field.ts)
- [date-field.ts](file://packages/core/database/src/fields/date-field.ts)
- [boolean-field.ts](file://packages/core/database/src/fields/boolean-field.ts)
- [json-field.ts](file://packages/core/database/src/fields/json-field.ts)
- [field-validation.ts](file://packages/core/database/src/utils/field-validation.ts)
- [CollectionFieldInterface.ts](file://packages/core/client/src/data-source/collection-field-interface/CollectionFieldInterface.ts)
- [constants.ts](file://packages/core/client/src/collection-manager/constants.ts)
- [field-type-map.ts](file://packages/core/database/src/view/field-type-map.ts)
</cite>

## 目录
1. [介绍](#介绍)
2. [核心字段类型](#核心字段类型)
3. [数据验证规则](#数据验证规则)
4. [默认值设置](#默认值设置)
5. [格式化选项](#格式化选项)
6. [字段接口与UI组件映射](#字段接口与ui组件映射)
7. [自定义字段渲染](#自定义字段渲染)
8. [最佳实践](#最佳实践)
9. [高级用法示例](#高级用法示例)

## 介绍
NocoBase提供了一套完整的字段类型系统，用于定义和管理数据模型中的各种数据类型。本文档详细介绍了NocoBase支持的各种字段类型，包括字符串、数字、日期、布尔值、JSON等，以及它们的配置参数、数据验证规则、默认值设置和格式化选项。

**Section sources**
- [string-field.ts](file://packages/core/database/src/fields/string-field.ts)
- [number-field.ts](file://packages/core/database/src/fields/number-field.ts)

## 核心字段类型
NocoBase支持多种核心字段类型，每种类型都有特定的用途和配置选项。

### 字符串类型
字符串类型用于存储文本数据，支持长度限制和自动修剪功能。

```mermaid
classDiagram
class StringField {
+string name
+number length
+boolean trim
+get dataType() DataType
+additionalSequelizeOptions() Object
}
```

**Diagram sources**
- [string-field.ts](file://packages/core/database/src/fields/string-field.ts)

### 数字类型
数字类型包括整数、浮点数和高精度小数，支持不同的精度和范围设置。

```mermaid
classDiagram
class NumberField {
+string type
+get dataType() DataType
}
class IntegerField {
+get dataType() DataType
}
class FloatField {
+get dataType() DataType
}
class DecimalField {
+number precision
+number scale
+get dataType() DataType
}
NumberField <|-- IntegerField
NumberField <|-- FloatField
NumberField <|-- DecimalField
```

**Diagram sources**
- [number-field.ts](file://packages/core/database/src/fields/number-field.ts)

### 日期类型
日期类型支持多种日期格式和时区处理，包括创建时间和更新时间等特殊字段。

```mermaid
classDiagram
class DateField {
+boolean defaultToCurrentTime
+boolean onUpdateToCurrentTime
+string timezone
+get dataType() DataType
+init() void
+setter(value, options) any
+additionalSequelizeOptions() Object
+bind() void
+unbind() void
}
```

**Diagram sources**
- [date-field.ts](file://packages/core/database/src/fields/date-field.ts)

### 布尔类型
布尔类型用于存储真/假值，通常用于开关或状态标记。

```mermaid
classDiagram
class BooleanField {
+get dataType() DataType
}
```

**Diagram sources**
- [boolean-field.ts](file://packages/core/database/src/fields/boolean-field.ts)

### JSON类型
JSON类型用于存储结构化数据，支持JSON和JSONB两种数据库类型。

```mermaid
classDiagram
class JsonField {
+boolean jsonb
+get dataType() DataType
}
class JsonbField {
+get dataType() DataType
}
JsonField <|-- JsonbField
```

**Diagram sources**
- [json-field.ts](file://packages/core/database/src/fields/json-field.ts)

## 数据验证规则
NocoBase提供了丰富的数据验证规则，确保数据的完整性和一致性。

### 字符串验证规则
字符串字段支持多种验证规则，包括长度限制、正则表达式匹配、电子邮件格式等。

```mermaid
flowchart TD
Start([开始]) --> Required{"必填?"}
Required --> |否| End([结束])
Required --> |是| Length{"长度验证?"}
Length --> |否| Pattern{"正则表达式?"}
Length --> |是| MinLength["最小长度检查"]
Length --> |是| MaxLength["最大长度检查"]
MinLength --> Pattern
MaxLength --> Pattern
Pattern --> |是| RegexCheck["正则表达式匹配"]
Pattern --> |否| Email{"电子邮件?"}
Email --> |是| EmailCheck["电子邮件格式验证"]
Email --> |否| UUID{"UUID?"}
UUID --> |是| UUIDCheck["UUID格式验证"]
UUID --> |否| URI{"URI?"}
URI --> |是| URICheck["URI格式验证"]
URI --> |否| End
RegexCheck --> End
EmailCheck --> End
UUIDCheck --> End
URICheck --> End
```

**Diagram sources**
- [constants.ts](file://packages/core/client/src/collection-manager/constants.ts)

### 数字验证规则
数字字段支持范围验证、精度控制和整数检查等规则。

```mermaid
flowchart TD
Start([开始]) --> Required{"必填?"}
Required --> |否| End([结束])
Required --> |是| Min{"最小值?"}
Min --> |是| MinCheck["最小值检查"]
Min --> |否| Max{"最大值?"}
Max --> |是| MaxCheck["最大值检查"]
Max --> |否| Integer{"整数?"}
Integer --> |是| IntegerCheck["整数检查"]
Integer --> |否| Precision{"精度?"}
Precision --> |是| PrecisionCheck["精度检查"]
Precision --> |否| End
MinCheck --> Max
MaxCheck --> Integer
IntegerCheck --> Precision
PrecisionCheck --> End
```

**Diagram sources**
- [constants.ts](file://packages/core/client/src/collection-manager/constants.ts)

### 日期验证规则
日期字段支持时间范围验证和时间戳格式检查。

```mermaid
flowchart TD
Start([开始]) --> Required{"必填?"}
Required --> |否| End([结束])
Required --> |是| Min{"最小日期?"}
Min --> |是| MinCheck["最小日期检查"]
Min --> |否| Max{"最大日期?"}
Max --> |是| MaxCheck["最大日期检查"]
Max --> |否| Timestamp{"时间戳?"}
Timestamp --> |是| TimestampCheck["时间戳格式检查"]
Timestamp --> |否| End
MinCheck --> Max
MaxCheck --> Timestamp
TimestampCheck --> End
```

**Diagram sources**
- [constants.ts](file://packages/core/client/src/collection-manager/constants.ts)

## 默认值设置
字段的默认值设置允许在创建记录时自动填充特定值。

### 静态默认值
静态默认值是在字段定义时指定的固定值。

```mermaid
sequenceDiagram
participant User as "用户"
participant Form as "表单"
participant Field as "字段"
User->>Form : 创建新记录
Form->>Field : 初始化字段
Field->>Field : 检查是否有默认值
alt 有默认值
Field-->>Form : 设置默认值
else 无默认值
Field-->>Form : 不设置值
end
Form-->>User : 显示表单
```

**Diagram sources**
- [CollectionFieldInterface.ts](file://packages/core/client/src/data-source/collection-field-interface/CollectionFieldInterface.ts)

### 动态默认值
动态默认值是通过表达式或函数计算得出的值。

```mermaid
sequenceDiagram
participant User as "用户"
participant Form as "表单"
participant Field as "字段"
participant Calculator as "计算器"
User->>Form : 创建新记录
Form->>Field : 初始化字段
Field->>Calculator : 计算默认值
Calculator-->>Field : 返回计算结果
Field-->>Form : 设置计算结果为默认值
Form-->>User : 显示表单
```

**Diagram sources**
- [CollectionFieldInterface.ts](file://packages/core/client/src/data-source/collection-field-interface/CollectionFieldInterface.ts)

## 格式化选项
格式化选项允许对字段值进行显示格式的控制。

### 数字格式化
数字字段支持多种格式化选项，包括小数位数、千位分隔符等。

```mermaid
classDiagram
class NumberFormattingOptions {
+number precision
+string separator
+boolean useGrouping
+string currency
+format(value) string
}
```

**Diagram sources**
- [number-field.ts](file://packages/core/database/src/fields/number-field.ts)

### 日期格式化
日期字段支持自定义日期和时间格式。

```mermaid
classDiagram
class DateFormattingOptions {
+string dateFormat
+string timeFormat
+boolean showTime
+string timezone
+format(value) string
}
```

**Diagram sources**
- [date-field.ts](file://packages/core/database/src/fields/date-field.ts)

## 字段接口与UI组件映射
字段接口定义了字段在用户界面中的表现形式和交互方式。

### 字段接口配置
字段接口配置决定了字段在表单中的渲染方式。

```mermaid
classDiagram
class CollectionFieldInterface {
+string name
+string title
+string group
+Object default
+Object properties
+Array componentOptions
+validationType string
+availableValidationOptions Array
+excludeValidationOptions Array
+getConfigureFormProperties(collectionInfo) Object
+getDefaultValueProperty() Object
+addComponentOption(componentOption) void
}
```

**Diagram sources**
- [CollectionFieldInterface.ts](file://packages/core/client/src/data-source/collection-field-interface/CollectionFieldInterface.ts)

### UI组件映射
不同的字段类型映射到不同的UI组件，提供最佳的用户体验。

```mermaid
flowchart TD
StringType --> Input["Input"]
NumberType --> InputNumber["InputNumber"]
DateType --> DatePicker["DatePicker"]
BooleanType --> Checkbox["Checkbox"]
JSONType --> JSONInput["Input.JSON"]
subgraph "字段类型"
StringType["字符串"]
NumberType["数字"]
DateType["日期"]
BooleanType["布尔"]
JSONType["JSON"]
end
subgraph "UI组件"
Input
InputNumber
DatePicker
Checkbox
JSONInput
end
```

**Diagram sources**
- [field-type-map.ts](file://packages/core/database/src/view/field-type-map.ts)

## 自定义字段渲染
NocoBase支持自定义字段渲染，允许开发者创建独特的字段表现形式。

### 自定义组件选项
通过添加自定义组件选项，可以扩展字段的渲染能力。

```mermaid
sequenceDiagram
participant Developer as "开发者"
participant FieldInterface as "字段接口"
participant ComponentOption as "组件选项"
Developer->>FieldInterface : 获取字段接口
FieldInterface-->>Developer : 返回接口实例
Developer->>ComponentOption : 创建组件选项
ComponentOption-->>Developer : 返回选项对象
Developer->>FieldInterface : 添加组件选项
FieldInterface->>FieldInterface : 更新组件选项列表
FieldInterface-->>Developer : 确认添加成功
```

**Diagram sources**
- [CollectionFieldInterface.ts](file://packages/core/client/src/data-source/collection-field-interface/CollectionFieldInterface.ts)

## 最佳实践
遵循最佳实践可以提高数据质量和系统性能。

### 性能优化
合理的字段配置可以显著提升系统性能。

```mermaid
flowchart TD
A["选择合适的数据类型"] --> B["为查询字段添加索引"]
B --> C["避免过度使用JSON字段"]
C --> D["合理设置字段长度"]
D --> E["使用适当的验证规则"]
E --> F["定期审查字段配置"]
```

**Diagram sources**
- [field-type-map.ts](file://packages/core/database/src/view/field-type-map.ts)

### 数据完整性保障
确保数据的完整性和一致性是系统稳定运行的基础。

```mermaid
flowchart TD
A["定义明确的验证规则"] --> B["设置合理的默认值"]
B --> C["使用外键约束"]
C --> D["实施数据审计"]
D --> E["定期备份数据"]
E --> F["监控数据质量"]
```

**Diagram sources**
- [field-validation.ts](file://packages/core/database/src/utils/field-validation.ts)

## 高级用法示例
以下是一些复杂字段配置的高级用法示例。

### 复合验证规则
组合多个验证规则以实现复杂的业务逻辑。

```mermaid
sequenceDiagram
participant Field as "字段"
participant Validator as "验证器"
participant Rule1 as "规则1"
participant Rule2 as "规则2"
participant Rule3 as "规则3"
Field->>Validator : 提交值进行验证
Validator->>Rule1 : 执行规则1
Rule1-->>Validator : 返回结果
alt 规则1通过
Validator->>Rule2 : 执行规则2
Rule2-->>Validator : 返回结果
alt 规则2通过
Validator->>Rule3 : 执行规则3
Rule3-->>Validator : 返回结果
Validator-->>Field : 所有规则通过
else 规则2失败
Validator-->>Field : 规则2失败
end
else 规则1失败
Validator-->>Field : 规则1失败
end
```

**Diagram sources**
- [field-validation.ts](file://packages/core/database/src/utils/field-validation.ts)

### 动态字段配置
根据上下文动态调整字段配置。

```mermaid
sequenceDiagram
participant User as "用户"
participant Form as "表单"
participant FieldManager as "字段管理器"
participant Context as "上下文"
User->>Form : 打开表单
Form->>Context : 获取当前上下文
Context-->>Form : 返回上下文信息
Form->>FieldManager : 请求字段配置
FieldManager->>FieldManager : 根据上下文计算配置
FieldManager-->>Form : 返回动态配置
Form->>Form : 应用配置并渲染字段
Form-->>User : 显示配置后的表单
```

**Diagram sources**
- [CollectionFieldInterface.ts](file://packages/core/client/src/data-source/collection-field-interface/CollectionFieldInterface.ts)