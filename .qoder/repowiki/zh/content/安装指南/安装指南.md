# 安装指南

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [docker-compose.yml](file://docker-compose.yml)
- [.env.example](file://.env.example)
- [packages/core/create-nocobase-app/package.json](file://packages/core/create-nocobase-app/package.json)
- [packages/core/cli/package.json](file://packages/core/cli/package.json)
- [docker/nocobase/Dockerfile](file://docker/nocobase/Dockerfile)
- [docker/nocobase/docker-entrypoint.sh](file://docker/nocobase/docker-entrypoint.sh)
- [packages/core/create-nocobase-app/src/cli.js](file://packages/core/create-nocobase-app/src/cli.js)
- [packages/core/create-nocobase-app/src/generator.js](file://packages/core/create-nocobase-app/src/generator.js)
</cite>

## 目录
1. [简介](#简介)
2. [Docker部署安装](#docker部署安装)
3. [CLI工具安装](#cli工具安装)
4. [源码安装](#源码安装)
5. [docker-compose.yml配置详解](#docker-composeyml配置详解)
6. [常见安装问题排查](#常见安装问题排查)
7. [安装验证清单](#安装验证清单)
8. [不同操作系统的注意事项](#不同操作系统的注意事项)

## 简介

NocoBase是一个以可扩展性为先的开源无代码开发平台。通过NocoBase，您可以在几分钟内部署一个私有的、可控的、高度可扩展的无代码开发平台，而无需投入数年时间和数百万美元的研发成本。NocoBase支持三种安装方式：Docker部署、CLI工具安装和源码安装，每种方式都针对不同的使用场景和用户需求。

**本文档来源**
- [README.md](file://README.md#L77-L91)

## Docker部署安装

Docker部署是推荐的安装方式，特别适合无代码场景，无需编写任何代码。当需要升级时，只需下载最新的镜像并重启即可。Docker部署通过docker-compose.yml文件定义了多个服务，包括数据库、管理界面和NocoBase应用本身。

安装步骤：
1. 确保已安装Docker和Docker Compose
2. 克隆NocoBase仓库或下载docker-compose.yml文件
3. 创建并配置.env环境变量文件
4. 运行`docker-compose up -d`启动所有服务
5. 访问NocoBase应用进行初始化设置

**本文档来源**
- [README.md](file://README.md#L81-L83)
- [docker-compose.yml](file://docker-compose.yml#L1-L80)

## CLI工具安装

CLI工具安装方式通过create-nocobase-app工具创建项目，项目业务代码完全独立，支持低代码开发。这种方式适合需要对项目进行定制开发的用户。

安装步骤：
1. 确保已安装Node.js（版本>=18）和yarn包管理器
2. 全局安装create-nocobase-app工具：`yarn create nocobase-app my-app`
3. 按照提示完成项目创建和配置
4. 进入项目目录并运行`yarn install`安装依赖
5. 运行`yarn nocobase install`进行应用安装
6. 启动应用：`yarn dev`

**本文档来源**
- [README.md](file://README.md#L85-L87)
- [packages/core/create-nocobase-app/package.json](file://packages/core/create-nocobase-app/package.json#L1-L23)
- [packages/core/cli/package.json](file://packages/core/cli/package.json#L1-L38)

## 源码安装

源码安装方式适合想要体验最新未发布版本，或希望参与贡献、需要在源码上进行修改和调试的用户。这种方式需要较高的开发技能，当代码更新时，可以通过git pull获取最新代码。

安装步骤：
1. 克隆NocoBase源码仓库
2. 确保已安装Node.js（版本>=18）、yarn和Git
3. 在项目根目录运行`yarn install`安装所有依赖
4. 运行`yarn build`构建项目
5. 配置环境变量文件
6. 启动应用：`yarn start`

**本文档来源**
- [README.md](file://README.md#L89-L91)
- [package.json](file://package.json#L1-L101)

## docker-compose.yml配置详解

docker-compose.yml文件定义了NocoBase的多服务架构，包含数据库、管理界面和应用服务等组件。

### 服务配置

#### 数据库连接配置
- **MySQL服务**：使用mysql:8镜像，通过环境变量配置数据库名称、用户和密码，端口映射为${DB_MYSQL_PORT}:3306
- **PostgreSQL服务**：使用postgres:latest镜像，配置wal_level=logical以支持逻辑复制，端口映射为${DB_POSTGRES_PORT}:5432
- **Kingbase服务**：使用专用镜像，端口映射为${DB_KINGBASE_PORT}:54321

#### 端口映射
- **Adminer服务**：端口映射为${ADMINER_PORT}:8080，提供数据库管理界面
- **NocoBase应用**：端口映射为${APP_PORT}:${APP_PORT}，暴露应用服务端口
- **Verdaccio服务**：端口映射为${VERDACCIO_PORT}:${VERDACCIO_PORT}，提供私有npm仓库

#### 卷挂载
- **Kingbase数据库**：将./storage/db/kingbase挂载到容器内的/home/kingbase/userdata，实现数据持久化
- **PostgreSQL备份**：将./storage/db/postgres/backups挂载到容器内的/backups，用于数据库备份
- **NocoBase应用**：将当前目录挂载到容器内的/app，实现代码同步

**本文档来源**
- [docker-compose.yml](file://docker-compose.yml#L1-L80)
- [.env.example](file://.env.example#L1-L98)

## 常见安装问题排查

### 端口冲突
当指定端口已被其他进程占用时，会导致服务启动失败。解决方案：
1. 检查端口占用情况：`netstat -an | grep <端口号>`
2. 修改.env文件中的端口配置
3. 重启Docker服务

### 数据库连接失败
数据库连接失败可能由以下原因导致：
1. 数据库服务未启动：检查docker-compose中数据库服务状态
2. 连接参数错误：核对.env文件中的DB_HOST、DB_PORT、DB_DATABASE等配置
3. 网络问题：确保应用服务与数据库服务在同一网络中

### 权限问题
在Linux系统上运行Docker时可能出现权限问题：
1. 确保用户在docker用户组中：`sudo usermod -aG docker $USER`
2. 检查存储目录权限：确保storage目录有适当的读写权限
3. 使用sudo运行docker命令（不推荐，仅作为临时解决方案）

**本文档来源**
- [docker-compose.yml](file://docker-compose.yml#L2-L5)
- [.env.example](file://.env.example#L46-L55)
- [docker/nocobase/docker-entrypoint.sh](file://docker/nocobase/docker-entrypoint.sh#L1-L56)

## 安装验证清单

为确保NocoBase安装成功，请按以下清单进行验证：

1. **服务状态检查**
   - 运行`docker-compose ps`确认所有服务状态为"Up"
   - 检查NocoBase、数据库和Adminer服务是否正常运行

2. **网络连接验证**
   - 访问http://localhost:${APP_PORT}确认NocoBase应用可访问
   - 访问http://localhost:${ADMINER_PORT}确认数据库管理界面可访问

3. **数据库连接测试**
   - 使用Adminer登录数据库，验证连接信息正确
   - 检查NocoBase相关表是否已自动创建

4. **功能完整性检查**
   - 登录NocoBase应用，验证基本功能正常
   - 创建测试数据表，验证CRUD操作

5. **环境变量验证**
   - 确认.env文件中的配置已正确加载
   - 检查数据库连接参数、应用端口等关键配置

**本文档来源**
- [docker-compose.yml](file://docker-compose.yml#L68-L80)
- [.env.example](file://.env.example#L11-L15)
- [docker/nocobase/docker-entrypoint.sh](file://docker/nocobase/docker-entrypoint.sh#L46-L47)

## 不同操作系统的注意事项

### Windows系统
- 确保已安装Docker Desktop for Windows
- 注意文件路径分隔符差异，使用正斜杠或双反斜杠
- 可能需要在Docker设置中启用文件共享
- 防火墙可能阻止端口映射，需要手动配置例外

### macOS系统
- 推荐使用Docker Desktop for Mac
- 注意资源限制，默认内存可能不足，建议增加到4GB以上
- 文件系统性能较好，但需要确保存储目录有足够空间
- zsh用户可能需要配置shell环境变量

### Linux系统
- 确保内核版本支持Docker
- 建议使用systemd管理Docker服务
- 注意用户权限，将用户添加到docker组
- 文件系统权限需要特别注意，避免权限不足问题
- SELinux可能影响容器运行，需要适当配置

**本文档来源**
- [docker-compose.yml](file://docker-compose.yml#L2-L5)
- [docker/nocobase/Dockerfile](file://docker/nocobase/Dockerfile#L1-L49)
- [packages/core/create-nocobase-app/src/cli.js](file://packages/core/create-nocobase-app/src/cli.js#L1-L45)